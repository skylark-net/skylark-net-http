/**
 * skylark-net-http - The skylark http  library.
 * @author Hudaokeji Co.,Ltd
 * @version v0.9.0
 * @link www.skylarkjs.org
 * @license MIT
 */
define(["skylark-langx-types","skylark-langx-objects","skylark-langx-arrays","skylark-langx-async/Deferred","./Xhr","./http"],function(e,t,a,n,o,r){return r.upload=function(a){var r,i=t.mixin({contentRange:null,paramName:void 0,singleFileUploads:!0,limitMultiFileUploads:void 0,limitMultiFileUploadSize:void 0,limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:void 0,multipart:!0,maxChunkSize:void 0,uploadedBytes:void 0,recalculateProgress:!0,progressInterval:100,autoUpload:!0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(e,a){return e=this.messages[e]||e.toString(),a&&t.each(a,function(t,a){e=e.replace("{"+t+"}",a)}),e},formData:function(e){return e.serializeArray()},add:function(e,t){if(e.isDefaultPrevented())return!1;(t.autoUpload||!1!==t.autoUpload&&$(this).fileupload("option","autoUpload"))&&t.process().done(function(){t.submit()})},processData:!1,contentType:!1,cache:!1},a),l=function(){return(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice).apply(this,arguments)},s=function(e){return o.request(e.url,e)};function p(a){var n,o=a.files[0],r=a.multipart,i="array"===e.type(a.paramName)?a.paramName[0]:a.paramName;a.headers=t.mixin({},a.headers),a.contentRange&&(a.headers["Content-Range"]=a.contentRange),r?(n=new FormData,a.blob?n.append(i,a.blob,o.name):t.each(a.files,function(t,o){n.append("array"===e.type(a.paramName)&&a.paramName[t]||i,o,o.uploadName||o.name)}),a.data=n):(a.headers["Content-Disposition"]='attachment; filename="'+encodeURI(o.name)+'"',a.contentType=o.type||"application/octet-stream",a.data=a.blob||o),a.blob=null}function u(e,a){e.uploadedBytes=e.uploadedBytes||0;var o,r,i=e.files[0],u=i.size,d=e.uploadedBytes,c=e.maxChunkSize||u,m=l,y=new n,f=y.promise;return!(!m||!(d||c<u)||e.data)&&(!!a||(d>=u?(i.error=e.i18n("uploadedBytes"),this._getXHRPromise(!1,e.context,[null,"error",i.error])):(r=function(){var a=t.mixin({},e),n=a._progress.loaded;a.blob=m.call(i,d,d+c,i.type),a.chunkSize=a.blob.size,a.contentRange="bytes "+d+"-"+(d+a.chunkSize-1)+"/"+u,p(a),o=s(a).done(function(t,o,i){d=function(e){var t=e.getResponseHeader("Range"),a=t&&t.split("-"),n=a&&a.length>1&&parseInt(a[1],10);return n&&n+1}(i)||d+a.chunkSize,n+a.chunkSize-a._progress.loaded&&y.progress({lengthComputable:!0,loaded:d-a.uploadedBytes,total:d-a.uploadedBytes}),e.uploadedBytes=a.uploadedBytes=d,a.result=t,a.textStatus=o,a.jqXHR=i,d<u?r():y.resolveWith(a.context,[t,o,i])}).fail(function(e,t,n){a.jqXHR=e,a.textStatus=t,a.errorThrown=n,y.rejectWith(a.context,[e,t,n])})},f.abort=function(){return o.abort()},r(),f)))}(r=i).type=r.type||"POST",u(r,!0)||r.data||p(r);var d=u(i)||s(i);return d.options=i,d}});
//# sourceMappingURL=sourcemaps/upload.js.map
